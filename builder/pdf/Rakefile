require 'rake/clean'
require 'pathname'
require 'rake/ext/pathname'

PDF_FILE = Pathname(ENV['DBP_PDF_FILE'])
PDF_FORMAT_FILE = Pathname(ENV['DBP_PDF_FORMAT_FILE'])

OUT_DIR = PDF_FILE.dirname

directory OUT_DIR

desc 'Typeset the book as a PDF file'
task default: [:pdf]

desc 'Typeset the book as a PDF file'
task pdf: [PDF_FILE]

file PDF_FILE => [OUT_DIR] do |t|
  sh 'pdftex', '-interaction=batchmode', '-fmt', PDF_FORMAT_FILE.to_s, '-jobname', t.name.pathmap('%X'), 'book'
end
file PDF_FILE => FileList['**/*.tex']
file PDF_FILE => [PDF_FORMAT_FILE]

CLOBBER.include(PDF_FILE, PDF_FILE.ext('log'))
